(this["webpackJsonpreact-dnd-dashboard"]=this["webpackJsonpreact-dnd-dashboard"]||[]).push([[0],{110:function(e,a,t){},240:function(e,a,t){"use strict";t.r(a);var n,r=t(0),i=t(17),c=t.n(i),s=(t(110),t(8)),l=t(18),o=t.n(l);!function(e){e[e.PREDICT=0]="PREDICT",e[e.RAINFALL=1]="RAINFALL"}(n||(n={}));var d,u,b=t(1),j=function(e){var a=e.title,t=e.variant,n=o()("bg-red-500 text-white h-24 w-full flex justify-center items-center text-2xl",{"bg-red-500":"red"===t,"bg-yellow-500":"yellow"===t,"bg-green-500":"green"===t,"bg-pink-500":"pink"===t});return Object(b.jsx)("div",{className:n,children:a})},p=t(2),f=t(32),h=function(e){var a=e.name,t=e.id,n=e.children,r=e.data,i=e.close,c=e.onClose,s=Object(f.b)({id:t,data:r}),l=s.attributes,o=s.listeners,d=s.setNodeRef,u=s.transform,j=u?{transform:"translate3d(".concat(u.x,"px, ").concat(u.y,"px, 0)")}:void 0;return Object(b.jsxs)("div",{className:"w-full h-full",ref:d,style:j,children:[Object(b.jsxs)("div",{className:"p-4 flex justify-between bg-blue-300 space-x-6",children:[Object(b.jsx)("h4",{className:"text-lg text-gray-600",children:a}),Object(b.jsx)("div",{className:"flex items-center space-x-6",children:i?Object(b.jsx)("button",{onClick:c,className:"text-black",children:Object(b.jsx)("i",{className:"gg-close-o"})}):Object(b.jsx)("button",Object(p.a)(Object(p.a)(Object(p.a)({className:"cursor-move text-black"},o),l),{},{children:Object(b.jsx)("i",{className:"gg-controller"})}))})]}),n]})},v=t(34),x=function(e){var a=e.variant,t=e.children,n=e.className,r=Object(v.a)(e,["variant","children","className"]);return Object(b.jsx)("button",Object(p.a)(Object(p.a)({},r),{},{className:o()({"bg-blue-400":"primary"===a,"bg-green-400":"secondary"===a},"rounded px-4 py-2 text-white",n),children:t}))},m=t(37),O=function(){return Object(m.b)()},y=m.c,g=t(9),N=t(52);!function(e){e.MaxTemperature="MaxT",e.MinTemperature="MinT",e.Humidity="RH"}(d||(d={})),function(e){e.Taina="F-D0047-079",e.Kaohsiung="F-D0047-067",e.Taichung="F-D0047-075"}(u||(u={}));var w,T=t(241);function C(e){if("object"!==typeof e||!("predictor"in e))throw Error("Predict type error")}!function(e){e[e.Line=0]="Line",e[e.RawData=1]="RawData"}(w||(w={}));var R;!function(e){e.Kaohsiung="467440",e.Taichung="467490",e.Taipei="466920"}(R||(R={}));function D(e){if("object"!==typeof e||!("station"in e)||!("cardType"in e)||e.cardType!==n.RAINFALL)throw Error("Rainfall type error")}var L={dashboard:function(e){var a=localStorage.getItem(e);if(null!==a)return JSON.parse(a)}("dashboard")||[]},I=Object(N.b)({name:"card",initialState:L,reducers:{addCardToDashboard:function(e,a){e.dashboard.push(a.payload)},removeCardFromDashboard:function(e,a){e.dashboard=e.dashboard.filter((function(e){return e.id!==a.payload}))},updateRainfallCard:function(e,a){var t=e.dashboard.find((function(e){var t=e.id;return a.payload.id===t}));D(t);var n=a.payload,r=n.station,i=n.displayType,c=n.data;t.station=r,t.displayType=Number(i),c&&(t.data=Object(g.a)(c))},updatePredictCard:function(e,a){var t=e.dashboard.find((function(e){var t=e.id;return a.payload.id===t}));C(t);var n=a.payload,r=n.predictor,i=n.forecastCode,c=n.displayType,s=n.location,l=n.data;t.predictor=r,t.forecastCode=i,t.displayType=Number(c),t.location=s,l&&(t.data=Object(g.a)(l))},saveDashboard:function(e){localStorage.setItem("dashboard",JSON.stringify(e.dashboard))}}}),A=I.actions,E=A.addCardToDashboard,F=A.removeCardFromDashboard,S=A.updateRainfallCard,k=A.updatePredictCard,P=A.saveDashboard,B=I.reducer,K=function(){var e=Object(r.useState)(!0),a=Object(s.a)(e,2),t=a[0],i=a[1],c=O();return Object(b.jsx)("aside",{className:o()(t?"w-1/2":"w-0"),children:Object(b.jsx)("div",{className:"h-full bg-blue-600 sticky top-0 min-h-screen",children:Object(b.jsxs)("div",{className:"flex w-full h-full relative",children:[t&&Object(b.jsx)("div",{className:o()("flex flex-col h-full justify-between text-gray-200 p-4 w-full"),children:Object(b.jsxs)("div",{className:"w-full h-full",children:[Object(b.jsx)("div",{className:"flex items-center",children:Object(b.jsx)("h3",{className:"text-2xl",children:"Dashboard"})}),Object(b.jsxs)("div",{className:"space-y-2 mt-2.5 flex flex-col p-2",children:[Object(b.jsx)(h,{name:"\u9810\u6e2c\u5929\u6c23",id:"predict",close:!1,data:{type:n.PREDICT},children:Object(b.jsx)(j,{title:"\u9810\u6e2c\u5929\u6c23",variant:"green"})}),Object(b.jsx)(h,{name:"\u6bcf\u65e5\u96e8\u91cf\u8a18\u9304",id:"rainfall",close:!1,data:{type:n.RAINFALL},children:Object(b.jsx)(j,{title:"\u6bcf\u65e5\u96e8\u91cf\u8a18\u9304",variant:"yellow"})})]}),Object(b.jsx)("div",{className:"flex justify-end mt-2.5",children:Object(b.jsx)(x,{onClick:function(){return c(P()),void window.alert("\u5132\u5b58\u6210\u529f")},variant:"secondary",children:"\u5132\u5b58"})})]})}),Object(b.jsx)("button",{onClick:function(){return i(!t)},className:"w-6 h-6 right-3.5 top-1/2 -mr-7 bg-indigo-400 absolute shadow rounded-full flex items-center justify-center cursor-pointer",children:Object(b.jsx)("i",{className:o()(t?"gg-chevron-left":"gg-chevron-right")})})]})})})},M=function(e){var a=e.id,t=e.children,n=Object(f.c)({id:a}),r=n.isOver,i=n.setNodeRef;return Object(b.jsx)("div",{ref:i,className:o()("border w-full h-80 overflow-auto",{"border-blue-400":r}),style:{minHeight:"500px"},children:t})},H=t(15),J=t.n(H),V=t(23),z=function(e){var a=e.form,t=e.chart;return Object(b.jsx)("div",{className:"flex items-center justify-between w-full overflow-hidden",style:{minHeight:"500px"},children:Object(b.jsxs)("div",{className:"flex flex-col w-full items-start justify-between rounded bg-white shadow",children:[Object(b.jsx)("div",{className:"w-full  h-full flex-grow dark:bg-gray-800",style:{minHeight:"300px"},children:t}),Object(b.jsx)("div",{className:"w-full flex items-center max-h-16 h-full bg-gray-100 text-gray-600 p-2 text-sm space-y-1",children:a})]})})},U=[{label:"\u6700\u9ad8\u6eab\u5ea6",value:d.MaxTemperature},{label:"\u6700\u4f4e\u6eab\u5ea6",value:d.MinTemperature},{label:"\u6ebc\u5ea6",value:d.Humidity}],W=[{label:"\u9ad8\u96c4",value:u.Kaohsiung},{label:"\u81fa\u5357",value:u.Taina},{label:"\u81fa\u4e2d",value:u.Taichung}],q=[{label:"\u66f2\u7dda\u5716",value:w.Line},{label:"\u539f\u59cb\u8cc7\u6599",value:w.RawData}],G=function(e){switch(e){case u.Kaohsiung:return[{label:"\u9cf3\u5c71\u5340",value:"\u9cf3\u5c71\u5340"},{label:"\u6a4b\u982d\u5340",value:"\u6a4b\u982d\u5340"}];case u.Taichung:return[{label:"\u5317\u5c6f\u5340",value:"\u5317\u5c6f\u5340"},{label:"\u5927\u5b89\u5340",value:"\u5927\u5b89\u5340"}];case u.Taina:return[{label:"\u5b89\u5357\u5340",value:"\u5b89\u5357\u5340"},{label:"\u6771\u5c71\u5340",value:"\u6771\u5c71\u5340"}];default:throw Error("location option error")}},Q=[{label:"\u9ad8\u96c4",value:R.Kaohsiung},{label:"\u81fa\u4e2d",value:R.Taichung},{label:"\u81fa\u5317",value:R.Taipei}],X=t(99),Y=t.n(X).a.create({baseURL:"https://opendata.cwb.gov.tw/api/v1/rest/datastore",method:"get",params:{Authorization:"CWB-4A433294-5242-4AE1-90C5-B18BBDFBE0E5"}}),Z=function(e){var a=e.children;return Object(b.jsx)("div",{className:"flex items-center space-x-1",children:a})},$=t(104),_=function(e){var a=e.datasets,t=e.labels,n=e.datasetName;return Object(b.jsx)("div",{className:"w-full max-w-2xl mx-auto relative h-full",children:a.length?Object(b.jsx)($.a,{data:{labels:t,datasets:[{data:a,label:n}]}}):"no data"})},ee=function(e){var a=e.data;return Object(b.jsx)("pre",{children:a})},ae=function(e){var a=e.displayType,t=e.data,n=e.datasets,r=e.datasetName,i=e.labels;return a===w.Line&&n&&i&&r?Object(b.jsx)(_,{datasets:n,labels:i,datasetName:r}):a===w.RawData&&t?Object(b.jsx)(ee,{data:t}):Object(b.jsx)(b.Fragment,{})},te=t(31),ne=function(e){var a=e.value,t=e.name,n=e.options,i=Object(te.b)({name:t,value:a}),c=Object(s.a)(i,3),l=c[0],o=c[2].setValue;return Object(r.useEffect)((function(){n.find((function(e){return e.value===a}))||o(n[0].value)}),[n,o,a]),Object(b.jsx)("select",Object(p.a)(Object(p.a)({},l),{},{className:"px-4 py-2",children:n.map((function(e){var a=e.label,t=e.value;return Object(b.jsx)("option",{value:t,children:a},t)}))}))};function re(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(V.a)(J.a.mark((function e(a){var t,n,r,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.city,n=a.predictor,r=a.location,e.prev=1,e.next=4,Y.get("/".concat(t),{params:{elementName:n,locationName:r,sort:"time"}});case 4:return i=e.sent,e.abrupt("return",i.data.records.locations[0].location[0].weatherElement[0].time.map((function(e){return{startTime:e.startTime,value:e.elementValue[0].value}})));case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}var ce=function(e){var a,t,r=e.isEditable,i=void 0===r||r,c=e.id,s=e.close,l=void 0!==s&&s,o=y((function(e){return e.card.dashboard.find((function(e){return e.id===c}))})),d=O();C(o);var u=function(){return Object(b.jsx)("div",{className:"flex justify-between",children:Object(b.jsx)(te.a,{initialValues:{predictor:o.predictor,forecastCode:o.forecastCode,location:o.location,displayType:o.displayType},enableReinitialize:!0,onSubmit:function(){var e=Object(V.a)(J.a.mark((function e(a){var t,n,r,i,s;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.displayType,n=a.predictor,r=a.forecastCode,i=a.location,console.log(t,n,r,i),e.next=4,re({city:r,predictor:n,location:i});case 4:s=e.sent,d(k({id:c,predictor:n,forecastCode:r,displayType:t,location:i,data:s}));case 6:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),children:function(e){var a=e.values,t=e.handleSubmit,n=e.isSubmitting;return Object(b.jsxs)("form",{onSubmit:t,className:"flex space-x-4",children:[Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u89c0\u6e2c\u7ad9\uff1a"}),Object(b.jsx)(ne,{name:"predictor",options:U,value:a.predictor})]}),Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u7e23\u5e02\u4f4d\u7f6e\uff1a"}),Object(b.jsx)(ne,{name:"forecastCode",options:W,value:a.forecastCode})]}),Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u9109\u93ae\u4f4d\u7f6e\uff1a"}),Object(b.jsx)(ne,{name:"location",options:G(a.forecastCode),value:a.location})]}),Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u986f\u793a\u65b9\u5f0f\uff1a"}),Object(b.jsx)(ne,{name:"displayType",options:q,value:a.displayType})]}),Object(b.jsx)(x,{type:"submit",variant:n?"secondary":"primary",children:n?"Loading":"\u78ba\u8a8d"})]})}})})};return Object(b.jsx)(h,{onClose:function(){return d(F(c))},close:l,data:{type:n.PREDICT},id:c,name:"\u9810\u6e2c\u5929\u6c23\u5361\u7247",children:i?Object(b.jsx)(z,{form:Object(b.jsx)(u,{}),chart:Object(b.jsx)(ae,{displayType:o.displayType,data:JSON.stringify(o.data,null,2),datasetName:o.location,datasets:null===(a=o.data)||void 0===a?void 0:a.map((function(e){var a=e.value;return Number(a)})),labels:null===(t=o.data)||void 0===t?void 0:t.map((function(e){return e.startTime}))})}):Object(b.jsx)(j,{title:"\u9810\u6e2c\u5929\u6c23\u5361\u7247",variant:"green"})})};function se(e){return le.apply(this,arguments)}function le(){return(le=Object(V.a)(J.a.mark((function e(a){var t,n,r,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.get("/C-B0025-001",{params:{stationId:a}});case 3:return t=e.sent,n=t.data.records.location[0],r=n.station.stationName,i=n.stationObsTimes.stationObsTime,e.abrupt("return",{data:i.map((function(e){return{dataDate:e.dataDate,value:e.weatherElements.precipitation}})),station:r});case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}var oe=function(e){var a,t,r,i=e.id,c=e.close,s=void 0!==c&&c,l=y((function(e){return e.card.dashboard.find((function(e){return e.id===i}))})),o=O();D(l);var d=function(){return Object(b.jsx)("div",{className:"flex justify-between",children:Object(b.jsx)(te.a,{initialValues:{station:l.station,displayType:l.displayType},enableReinitialize:!0,onSubmit:function(){var e=Object(V.a)(J.a.mark((function e(a){var t,n,r,c;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.station,n=a.displayType,e.next=3,se(t);case 3:r=e.sent,c=r.data,o(S({id:i,station:t,displayType:n,data:c}));case 6:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),children:function(e){var a=e.values,t=e.handleSubmit,n=e.isSubmitting;return Object(b.jsxs)("form",{onSubmit:t,className:"flex space-x-4",children:[Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u89c0\u6e2c\u7ad9\uff1a"}),Object(b.jsx)(ne,{name:"station",options:Q,value:a.station})]}),Object(b.jsxs)(Z,{children:[Object(b.jsx)("span",{children:"\u986f\u793a\u65b9\u5f0f\uff1a"}),Object(b.jsx)(ne,{name:"displayType",options:q,value:a.displayType})]}),Object(b.jsx)(x,{type:"submit",variant:n?"secondary":"primary",children:n?"Loading":"\u78ba\u8a8d"})]})}})})};return Object(b.jsx)(h,{name:"\u6bcf\u65e5\u96e8\u91cf\u8a18\u9304",id:i,close:s,data:{type:n.RAINFALL},onClose:function(){o(F(i))},children:Object(b.jsx)(z,{form:Object(b.jsx)(d,{}),chart:Object(b.jsx)(ae,{displayType:l.displayType,data:JSON.stringify(l.data,null,2),datasets:null===(a=l.data)||void 0===a?void 0:a.map((function(e){var a=e.value;return Number(a)})),labels:null===(t=l.data)||void 0===t?void 0:t.map((function(e){return e.dataDate})),datasetName:null===(r=Q.find((function(e){return e.value===l.station})))||void 0===r?void 0:r.label})})})},de=function(){var e=y((function(e){return e.card.dashboard})),a=O();return Object(b.jsx)(f.a,{onDragEnd:function(e){var t,r=e.over,i=e.active;if(!r)return;switch(null===(t=i.data.current)||void 0===t?void 0:t.type){case n.PREDICT:a(E({id:Object(T.a)(),forecastCode:u.Kaohsiung,predictor:d.MinTemperature,cardType:n.PREDICT,displayType:w.Line,location:"\u9cf3\u5c71\u5340"}));break;case n.RAINFALL:a(E({id:Object(T.a)(),displayType:w.Line,station:R.Kaohsiung,cardType:n.RAINFALL}))}},children:Object(b.jsxs)("div",{className:"flex flex-no-wrap",children:[Object(b.jsx)(K,{}),Object(b.jsxs)("div",{className:"w-full container mx-auto p-4 space-y-4 flex flex-wrap flex-col",children:[Object.values(e).map((function(e){var a=e.id,t=e.cardType;return Object(b.jsxs)(M,{id:a,children:[t===n.PREDICT&&Object(b.jsx)(ce,{close:!0,id:a}),t===n.RAINFALL&&Object(b.jsx)(oe,{close:!0,id:a})]},a)})),Object(b.jsx)(M,{id:"empty"})]})]})})};var ue=function(){return Object(b.jsx)(de,{})},be=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,242)).then((function(a){var t=a.getCLS,n=a.getFID,r=a.getFCP,i=a.getLCP,c=a.getTTFB;t(e),n(e),r(e),i(e),c(e)}))},je=Object(N.a)({reducer:{card:B}});c.a.render(Object(b.jsx)(m.a,{store:je,children:Object(b.jsx)(ue,{})}),document.getElementById("root")),be()}},[[240,1,2]]]);
//# sourceMappingURL=main.c74d985c.chunk.js.map